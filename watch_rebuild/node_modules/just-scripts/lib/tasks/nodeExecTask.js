"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.nodeExecTask = void 0;
const utils_1 = require("../utils");
const just_task_1 = require("just-task");
const resolve_1 = require("just-task/lib/resolve");
const getTsNodeEnv_1 = require("../typescript/getTsNodeEnv");
function nodeExecTask(options) {
    return function () {
        const { spawnOptions, enableTypeScript, tsconfig, transpileOnly } = options;
        const tsNodeRegister = (0, resolve_1.resolveCwd)('ts-node/register');
        const nodeExecPath = process.execPath;
        if (enableTypeScript && tsNodeRegister) {
            options.args = options.args || [];
            options.args.unshift(tsNodeRegister);
            options.args.unshift('-r');
            options.env = { ...options.env, ...(0, getTsNodeEnv_1.getTsNodeEnv)(tsconfig, transpileOnly) };
            just_task_1.logger.info('Executing [TS]: ' + [nodeExecPath, ...(options.args || [])].join(' '));
        }
        else {
            just_task_1.logger.info('Executing: ' + [nodeExecPath, ...(options.args || [])].join(' '));
        }
        return (0, utils_1.spawn)(nodeExecPath, options.args, { stdio: 'inherit', env: options.env, ...spawnOptions });
    };
}
exports.nodeExecTask = nodeExecTask;
//# sourceMappingURL=nodeExecTask.js.map