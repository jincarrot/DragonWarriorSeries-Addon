{"version":3,"sources":["../../scripts/main.ts","../../scripts/watch3.0/modules/ability.ts","../../scripts/watch3.0/config/dragons.ts","../../scripts/watch3.0/utils/game.ts","../../scripts/watch3.0/modules/projectile.ts","../../scripts/watch3.0/modules/detection.ts","../../scripts/watch3.0/modules/collisions.ts","../../scripts/watch3.0/config/abilities.ts","../../scripts/watch3.0/errors/abilityError.ts","../../scripts/watch3.0/errors/dragonError.ts","../../scripts/watch3.0/managers/abilityManager.ts","../../scripts/watch3.0/managers/warriorManager.ts","../../scripts/watch3.0/modules/warrior.ts","../../scripts/watch3.0/modules/dragon.ts","../../scripts/watch3.0/errors/warriorError.ts","../../scripts/watch3.0/modules/watch.ts","../../scripts/watch3.0/managers/manager.ts"],"sourcesContent":["import { world } from \"@minecraft/server\"\r\nimport { manager } from \"./watch3.0/managers/manager\";\r\nimport { isDragon } from \"./watch3.0/utils/game\";\r\n\r\nlet aEvents = world.afterEvents;\r\n\r\naEvents.itemUse.subscribe((arg) => {\r\n    if (arg.itemStack.typeId.indexOf(\"dws:\") < 0) return;\r\n    let warrior = manager.warrior.getWarrior(arg.source.id);\r\n\r\n    // Show menu when use dragon watch.\r\n    if (arg.itemStack.typeId == 'dws:dragon_watch') {\r\n        warrior.watch.show();\r\n    }\r\n\r\n    // Dragon card.\r\n    if (arg.itemStack.typeId.indexOf(\"_card\") >= 0) {\r\n        let dragonType = arg.itemStack.typeId.replace(\"_card\", \"\");\r\n        if (isDragon(dragonType)) {\r\n            if (!warrior.hasDragon(dragonType)) {\r\n                warrior.addDragonByType(dragonType);\r\n                if (warrior.dragons.length == 1) {\r\n                    warrior.base.runCommand(\"give @s dws:dragon_watch\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n})\r\n","import { Entity, system, Vector3 } from \"@minecraft/server\";\r\nimport { Projectile, SimpleProjectile, TraceProjectile } from \"./projectile\";\r\nimport { DetectionBox } from \"./detection\";\r\nimport { ABILITIES } from \"../config/abilities\";\r\nimport { AbilityAttr, AbilityCallbacks, ProjectileAttr } from \"../interfaces/ability\";\r\nimport { AbilityStateType, TraceModeType } from \"../enums/ability\";\r\nimport { AbilityIdentifierError, AbilityProgressError } from \"../errors/abilityError\";\r\nimport { Collision } from \"./collisions\";\r\nimport { LivingDragon } from \"./dragon\";\r\n\r\n/**\r\n * Defines a collection of abilities.\r\n */\r\nexport class Ability {\r\n    private static _id = 0;\r\n    /**\r\n     * runtime identifier of this ability.\r\n     */\r\n    readonly id: number;\r\n    /**\r\n     * User of this ability.\r\n     */\r\n    user: LivingDragon;\r\n    /**\r\n     * Attributes of this ability.\r\n     */\r\n    readonly attr: AbilityAttr;\r\n    /**\r\n     * Projectiles that belong to this ability.\r\n     */\r\n    private projectiles: Projectile[];\r\n    /**\r\n     * Defines a set of areas, where will execute ability's function.\r\n     */\r\n    private detections: DetectionBox[];\r\n    /**\r\n     * Behaviors of this ability.\r\n     */\r\n    callbacks: AbilityCallbacks;\r\n    /**\r\n     * Attrs of its projectiles.\r\n     */\r\n    readonly projectileAttr: ProjectileAttr;\r\n    /**\r\n     * Id of the timer.\r\n     */\r\n    private runtimeId: number;\r\n    /**\r\n     * Ticks this ability ran.\r\n     */\r\n    private ticks: number;\r\n    /**\r\n     * State of this ability. Normal is 0, pause is 1 and stopped is 2.\r\n     */\r\n    private _state: AbilityStateType;\r\n\r\n    get state() {\r\n        return this._state;\r\n    }\r\n\r\n    constructor(user: LivingDragon, abilityId: number) {\r\n        if (!(abilityId in ABILITIES)) throw new AbilityIdentifierError(abilityId);\r\n        this.user = user;\r\n        this.attr = ABILITIES[abilityId];\r\n        this.projectileAttr = ABILITIES[abilityId].projectileAttr || {speed: 1};\r\n        this.projectiles = [];\r\n        this.detections = [];\r\n        this.callbacks = ABILITIES[abilityId].callbacks;\r\n        this.id = Ability._id++;\r\n        this.ticks = 0;\r\n        this._state = AbilityStateType.Running;\r\n        if (this.callbacks.start) this.callbacks.start(this);\r\n        this.runtimeId = system.runInterval(this.main, 2);\r\n        if (!this.projectileAttr.attributes) this.projectileAttr.attributes = this.attr.attributes;\r\n    }\r\n\r\n    /**\r\n     * Pause this ability. Use method \"resume\" to resume ability's running.\r\n     */\r\n    pause() {\r\n        if (this._state != AbilityStateType.Running) throw new AbilityProgressError(this._state, AbilityStateType.Pause);\r\n        this._state = AbilityStateType.Pause;\r\n        system.clearRun(this.runtimeId)\r\n        this.callbacks.pause ? this.callbacks.pause(this) : null;\r\n    }\r\n\r\n    /**\r\n     * Resume this ability if it was paused.\r\n     */\r\n    resume() {\r\n        if (this._state != AbilityStateType.Pause) throw new AbilityProgressError(this._state, AbilityStateType.Running);\r\n        this._state = AbilityStateType.Running;\r\n        this.runtimeId = system.runInterval(this.main, 2);\r\n        this.callbacks.resume ? this.callbacks.resume(this) : null;\r\n    }\r\n\r\n    /**\r\n     * Stop this ability. Cannot resume again.\r\n     */\r\n    stop() {\r\n        this._state = AbilityStateType.Stopped;\r\n        system.clearRun(this.runtimeId);\r\n        this.callbacks.stop ? this.callbacks.stop(this) : null;\r\n        this.clearAllProjectiles();\r\n        this.clearAllDetections();\r\n    }\r\n\r\n    /**\r\n     * Main process of this ability, runs every 2 ticks.\r\n     */\r\n    private main() {\r\n        for (let projectile of this.projectiles) \r\n            if (!projectile.base || !projectile.base.isValid) this.projectiles.splice(this.projectiles.indexOf(projectile), 1);\r\n        if (this._state == AbilityStateType.Running) {\r\n            if (this.callbacks.main) this.callbacks.main(this);\r\n            this.projectiles.forEach((projectile) => { projectile.main() });\r\n            this.detections.forEach((detection) => { detection.main() });\r\n            this.ticks += 2;\r\n            if (this.ticks > this.attr.duration) {\r\n                this._state = AbilityStateType.Finished;\r\n                system.clearRun(this.runtimeId);\r\n                if (this.callbacks.finish) this.callbacks.finish(this);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spawn a projectile in a location.\r\n     * @param typeId The identifier of the projectile.\r\n     * @param location The location where the projectile will spawn. \r\n     * If not specified, it will chose the location of the fist projectile which spawn previously, or the user's location.\r\n     */\r\n    spawnProjectile(typeId: string, location?: Vector3, traceMode = TraceModeType.Simple) {\r\n        // Get default location.\r\n        if (!location) location = this.projectiles ? this.projectiles[0].base.location : this.user.base.location;\r\n        let entity = this.user.base.dimension.spawnEntity(typeId, location);\r\n        let projectile = null;\r\n        switch (traceMode) {\r\n            case TraceModeType.Trace:\r\n                projectile = new TraceProjectile(entity, this.projectileAttr, undefined, this.callbacks.projectileCallbacks);\r\n                break;\r\n            case TraceModeType.Simple:\r\n                projectile = new SimpleProjectile(entity, this.projectileAttr, undefined, this.callbacks.projectileCallbacks);\r\n                break;\r\n        }\r\n        // Add tag to this projectile.\r\n        entity.addTag(`projectile#${this.id}:${projectile.id}`);\r\n        this.projectiles.push(projectile);\r\n        return projectile;\r\n    }\r\n\r\n    /**\r\n     * Get projectile with a specific id.\r\n     * @param projectileId Id of the target projectile.\r\n     */\r\n    getProjectile(projectileId: number) {\r\n        for (let projectile of this.projectiles) {\r\n            if (projectile.id == projectileId) return projectile;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns true if the specified projectile exist, else false.\r\n     * @param projectileId Id of the target projectile.\r\n     */\r\n    hasProjectile(projectileId: number) {\r\n        return this.getProjectile(projectileId) ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Delete a specific projectile.\r\n     * @param projectileId Id of the target projectile.\r\n     */\r\n    deleteProjectile(projectileId: number) {\r\n        let projectile = this.getProjectile(projectileId);\r\n        if (projectile) {\r\n            projectile.destory();\r\n            this.projectiles.splice(this.projectiles.indexOf(projectile), 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all projectiles.\r\n     */\r\n    clearAllProjectiles() {\r\n        for (let projectile of this.projectiles) \r\n            projectile.destory();\r\n        this.projectiles = [];\r\n    }\r\n\r\n    /**\r\n     * Create a detection.\r\n     */\r\n    createDetection(collision: Collision) {\r\n        let detection = new DetectionBox(collision, this.callbacks.detectingCallbacks);\r\n        this.detections.push(detection);\r\n        return detection;\r\n    }\r\n\r\n    /**\r\n     * Get detection with a specified id.\r\n     * @param detectionId Id of the target detection.\r\n     */\r\n    getDetection(detectionId: number) {\r\n        for (let detection of this.detections) {\r\n            if (detection.id == detectionId) return detection;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns true if the specified detection exist, else false.\r\n     * @param detectionId Id of the target detection.\r\n     */\r\n    hasDetection(detectionId: number) {\r\n        return this.getDetection(detectionId) ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Delete a specified detection.\r\n     * @param detectionId Id of the target detection.\r\n     */\r\n    deleteDetection(detectionId: number) {\r\n        let detection = this.getDetection(detectionId);\r\n        if (detection) {\r\n            detection.destory()\r\n            this.detections.splice(this.detections.indexOf(detection), 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all detections.\r\n     */\r\n    clearAllDetections() {\r\n        this.detections = [];\r\n    }\r\n}","function defaultLevelRule(exp: number): number {\r\n  return Math.floor(Math.sqrt(exp / 10));\r\n}\r\n\r\nfunction defaultEnergyRule(exp: number): number {\r\n  return Math.floor(Math.sqrt(exp / 10)) * 20;\r\n}\r\n\r\nexport let dragonData: Record<string, any> = {\r\n  \"dws:reguman\": {\r\n    maxExp: 1000,\r\n    name: \"雷古曼\",\r\n    rules: [defaultLevelRule, defaultEnergyRule],\r\n    attributes: [\"fire\"],\r\n    abilities: [],\r\n  },\r\n};\r\n","import { Entity, EntityFilter, EntityQueryOptions, EntityTypeFamilyComponent, Vector3 } from \"@minecraft/server\";\r\nimport { dragonData } from \"../config/dragons\";\r\n\r\n/**\r\n * Get the closest enermy of a specific entity.\r\n * @param entity \r\n */\r\nexport function getClosestEnermy(entity: Entity) {\r\n    let filter: EntityQueryOptions = {\r\n        families: [],\r\n        location: entity.location,\r\n        closest: 1\r\n    }\r\n    if ((entity.getComponent(\"minecraft:type_family\") as EntityTypeFamilyComponent).hasTypeFamily(\"monster\")){\r\n        filter.families?.push(\"player\");\r\n        filter.families?.push(\"dragon\");\r\n    }\r\n    else{\r\n        filter.families?.push(\"monster\");\r\n    }\r\n    return entity.dimension.getEntities(filter)[0];\r\n}\r\n\r\nexport function dist(a: Vector3, b: Vector3) {\r\n    return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2) + Math.pow(a.z - b.z, 2));\r\n}\r\n\r\nexport function isDragon(typeId: string) {\r\n    return typeId in dragonData;\r\n}","import { Entity, Vector3, world } from \"@minecraft/server\";\r\nimport { ElementType } from \"../enums/attr\";\r\nimport { ProjectileAttr, ProjectileCallbacks } from \"../interfaces/ability\";\r\nimport { dist, getClosestEnermy } from \"../utils/game\";\r\n\r\n/**\r\n * Base class of projectiles.\r\n */\r\nexport abstract class Projectile {\r\n    private static _id = 0;\r\n    readonly id: number;\r\n    base: Entity;\r\n    attr: ProjectileAttr;\r\n    callbacks: ProjectileCallbacks;\r\n\r\n    constructor(entity: Entity, attr: ProjectileAttr, callbacks?: ProjectileCallbacks) {\r\n        this.base = entity;\r\n        this.attr = attr;\r\n        this.callbacks = callbacks || {};\r\n        this.id = Projectile._id++;\r\n        if (!attr.range) attr.range = 1;\r\n        if (!attr.attributes) attr.attributes = [];\r\n    }\r\n\r\n    abstract main(): void;\r\n\r\n    destory() {\r\n        this.callbacks.despawn ? this.callbacks.despawn(this) : null;\r\n        this.base && this.base.isValid ? this.base.remove() : null;\r\n    }\r\n\r\n    detect() {\r\n        if (!this.base || !this.base.isValid) return;\r\n        let enermy = getClosestEnermy(this.base);\r\n        if (dist(enermy.location, this.base.location) <= (this.attr.range as number)){\r\n            if (this.callbacks.hitEntity) this.callbacks.hitEntity(this, enermy);\r\n            this.destory()\r\n            return;\r\n        }\r\n        let b = this.base.dimension.getBlock(this.base.location);\r\n        if (b && !b.isAir) {\r\n            if (this.callbacks.hitBlock) this.callbacks.hitBlock(this, b.location);\r\n            this.destory()\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Defines a projectile that will move in a specified direction.\r\n */\r\nexport class SimpleProjectile extends Projectile {\r\n    direction: Vector3;\r\n\r\n    constructor(entity: Entity, attr: ProjectileAttr, direction?: Vector3, callbacks?: ProjectileCallbacks) {\r\n        super(entity, attr, callbacks);\r\n        if (!direction) {\r\n            let targetLoc = getClosestEnermy(entity).location;\r\n            let ori = entity.location;\r\n            direction = {x: targetLoc.x - ori.x, y: targetLoc.y - ori.y, z: targetLoc.z - ori.z};\r\n        }\r\n        let dist = Math.sqrt(direction.x * direction.x + direction.y * direction.y + direction.z * direction.z);\r\n        direction = {x: direction.x / dist, y: direction.y / dist, z: direction.z / dist};\r\n        this.direction = direction;\r\n        this.callbacks.spawn ? this.callbacks.spawn(this) : null;\r\n    }\r\n\r\n    main() {\r\n        let dir = {\r\n            x: this.direction.x * this.attr.speed, \r\n            y: this.direction.y * this.attr.speed, \r\n            z: this.direction.z * this.attr.speed\r\n        }\r\n        this.base.applyImpulse(dir);\r\n        if (this.callbacks.main) this.callbacks.main(this)\r\n        this.detect()\r\n    }\r\n}\r\n\r\nexport class TraceProjectile extends Projectile {\r\n    target: Entity;\r\n\r\n    constructor(entity: Entity, attr: ProjectileAttr, target?: Entity, callbacks?: ProjectileCallbacks) {\r\n        super(entity, attr, callbacks);\r\n        if (!target) target = getClosestEnermy(entity);        \r\n        this.target = target;\r\n        this.callbacks.spawn ? this.callbacks.spawn(this) : null;\r\n    }\r\n\r\n    main() {\r\n        if (!this.target || !this.base || !this.target.isValid || !this.base.isValid) return;\r\n        let tarLoc = this.target.location;\r\n        let ori = this.base.location;\r\n        let dir = {x: tarLoc.x - ori.x, y: tarLoc.y - ori.y, z: tarLoc.z - ori.z};\r\n        let dist = Math.sqrt(dir.x * dir.x + dir.y * dir.y + dir.z * dir.z);\r\n        if (!dist) this.destory()\r\n        dir = {x: dir.x / dist, y: dir.y / dist, z: dir.z / dist};\r\n        dir = {\r\n            x: dir.x * this.attr.speed, \r\n            y: dir.y * this.attr.speed, \r\n            z: dir.z * this.attr.speed\r\n        }\r\n        this.base.applyImpulse(dir);\r\n        if (this.callbacks.main) this.callbacks.main(this)\r\n        this.detect()\r\n    }\r\n}","import { Entity } from \"@minecraft/server\";\r\nimport { DetectionCallbacks } from \"../interfaces/ability\";\r\nimport { Collision } from \"./collisions\";\r\n\r\n/**\r\n * Defines an area to apply the effect of an ability.\r\n */\r\nexport class DetectionBox {\r\n    private static _id = 0;\r\n    collision: Collision;\r\n    callbacks: DetectionCallbacks;\r\n    readonly id: number;\r\n    private _entites: Entity[];\r\n\r\n    /**\r\n     * Entities that in this area.\r\n     */\r\n    get entities() {\r\n        return this._entites;\r\n    }\r\n\r\n    constructor(collision: Collision, callbacks?: DetectionCallbacks) {\r\n        this.collision = collision;\r\n        this.callbacks = callbacks || {};\r\n        this.id = DetectionBox._id++;\r\n        this._entites = []\r\n        this.callbacks.create ? this.callbacks.create(this) : null;\r\n    }\r\n\r\n    main() {\r\n        this.refreshEntities();\r\n        this.callbacks.main ? this.callbacks.main(this) : null;\r\n    }\r\n\r\n    private refreshEntities() {\r\n        let newEntites = this.collision.getEntities();\r\n        let remove = this._entites.filter((entity) => !newEntites.includes(entity));\r\n        let add = newEntites.filter((entity) => !this._entites.includes(entity));\r\n        this._entites = newEntites;\r\n        remove.forEach((entity) => {\r\n            if (this.callbacks.leave) this.callbacks.leave(this, entity);\r\n        })\r\n        add.forEach((entity) => {\r\n            if (this.callbacks.enter) this.callbacks.enter(this, entity);\r\n        })\r\n    }\r\n\r\n    destory() {\r\n        this.callbacks.destory ? this.callbacks.destory(this) : null;\r\n    }\r\n}","import { Dimension, Entity, Vector3 } from \"@minecraft/server\";\r\n\r\nexport abstract class Collision {\r\n    dim: Dimension;\r\n    constructor(dim: Dimension) {this.dim = dim};\r\n    abstract getEntities(): Entity[];\r\n}\r\n\r\nexport class Sphere extends Collision{\r\n    origin: Vector3;\r\n    range: number;\r\n\r\n    constructor(origin: Vector3, range: number, dim: Dimension) {\r\n        super(dim);\r\n        this.origin = origin;\r\n        this.range = range;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let entities = this.dim.getEntities({location: {x: this.origin.x, y: this.origin.y, z: this.origin.z}, maxDistance: this.range});\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class Box extends Collision {\r\n    cornerA: Vector3;\r\n    cornerB: Vector3;\r\n\r\n    constructor(cornerA: Vector3, cornerB: Vector3, dim: Dimension) {\r\n        super(dim);\r\n        this.cornerA = cornerA;\r\n        this.cornerB = cornerB;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let volume = {x: this.cornerB.x - this.cornerA.x, y: this.cornerB.y - this.cornerA.y, z: this.cornerB.z - this.cornerA.z};\r\n        let entities = this.dim.getEntities({location: this.cornerA, volume: volume});\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class Ray extends Collision {\r\n    origin: Vector3;\r\n    direction: Vector3;\r\n    distance: number;\r\n\r\n    constructor(origin: Vector3, direction: Vector3, distance: number, dim: Dimension){\r\n        super(dim);\r\n        this.origin = origin;\r\n        this.direction = direction;\r\n        this.distance = distance;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let entityRayCasts = this.dim.getEntitiesFromRay(this.origin, this.direction, {\"maxDistance\": this.distance});\r\n        let entities = [];\r\n        for (let e of entityRayCasts){\r\n            entities.push(e.entity);\r\n        }\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class Segment extends Collision {\r\n    fromLocation: Vector3;\r\n    toLocation: Vector3;\r\n\r\n    constructor(fromLocation: Vector3, toLocation: Vector3, dim: Dimension){\r\n        super(dim);\r\n        this.fromLocation = fromLocation;\r\n        this.toLocation = toLocation;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let dir = {x: this.toLocation.x - this.fromLocation.x, y: this.toLocation.y - this.fromLocation.y, z: this.toLocation.z - this.fromLocation.z};\r\n        let dist = Math.sqrt(dir.x * dir.x + dir.y * dir.y + dir.z * dir.z);\r\n        let entityRayCasts = this.dim.getEntitiesFromRay(this.fromLocation, dir, {\"maxDistance\": dist});\r\n        let entities = [];\r\n        for (let e of entityRayCasts){\r\n            entities.push(e.entity);\r\n        }\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class Cylinder extends Collision {\r\n    origin: Vector3;\r\n    range: number;\r\n    height: number;\r\n\r\n    constructor(origin: Vector3, range: number, height: number, dim: Dimension) {\r\n        super(dim);\r\n        this.origin = origin;\r\n        this.range = range;\r\n        this.height = height;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let entities = this.dim.getEntities();\r\n        entities.forEach((entity) => {\r\n            let loc = entity.location;\r\n            if (Math.sqrt(loc.x * loc.x + loc.z * loc.z) <= this.range && loc.y - this.origin.y < this.height) {}\r\n            else entities.splice(entities.indexOf(entity), 1);\r\n        });\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class HollowSphere extends Sphere {\r\n    hollowRange: number;\r\n\r\n    constructor(origin: Vector3, range: number, hollowRange: number, dim: Dimension) {\r\n        if (hollowRange >= range) throw RangeError(`Value of parameter \"hollowRange\" should less than parameter \"range\".\\nReceived value:\\n hollowRange: ${hollowRange}\\n range: ${range}`);\r\n        super(origin, range, dim);\r\n        this.hollowRange = hollowRange;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let entities = this.dim.getEntities({location: {x: this.origin.x, y: this.origin.y, z: this.origin.z}, maxDistance: this.range, minDistance: this.hollowRange});\r\n        return entities;\r\n    }\r\n}\r\n\r\nexport class HollowCylinder extends Cylinder {\r\n    hollowRange: number;\r\n\r\n    constructor(origin: Vector3, range: number, hollowRange: number, height: number, dim: Dimension) {\r\n        if (hollowRange >= range) throw RangeError(`Value of parameter \"hollowRange\" should less than parameter \"range\".\\nReceived value:\\n hollowRange: ${hollowRange}\\n range: ${range}`);\r\n        super(origin, range, height, dim);\r\n        this.hollowRange = hollowRange;\r\n    }\r\n\r\n    getEntities(): Entity[] {\r\n        let entities = this.dim.getEntities();\r\n        entities.forEach((entity) => {\r\n            let loc = entity.location;\r\n            let dist = Math.sqrt(loc.x * loc.x + loc.z * loc.z)\r\n            if (this.hollowRange < dist && dist <= this.range && loc.y - this.origin.y < this.height) {}\r\n            else entities.splice(entities.indexOf(entity), 1);\r\n        });\r\n        return entities;\r\n    }\r\n}","import { AbilityType, TraceModeType } from \"../enums/ability\";\r\nimport { ElementType } from \"../enums/attr\";\r\nimport { AbilityCallbacks, AbilityDefinition } from \"../interfaces/ability\";\r\nimport { Ray } from \"../modules/collisions\";\r\nimport { getClosestEnermy } from \"../utils/game\";\r\n\r\n//type:normal(单独伤害),range(范围伤害),pierce(穿透伤害),defend(防御),line(光线)\r\nexport var abilities = [\r\n    {\r\n        \"name\": \"响雷火球\",\r\n        \"id\": 0,\r\n        \"attribute\": \"fire\",\r\n        \"particle\": [\"dws:spark\"],\r\n        \"base\": \"dws:fire_ball\",\r\n        \"value\": 11,\r\n        \"type\": \"normal\",\r\n        \"duration\": 0,\r\n        \"speed\": 1,\r\n        \"consume\": 30,\r\n        \"range\": 2,\r\n        \"autoClear\": 150,\r\n        \"effect\": {\r\n            \"name\": [\"fire\"],\r\n            \"time\": 5\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"炫光爆裂\",\r\n        \"id\": 1,\r\n        \"attribute\": \"gold\",\r\n        \"particle\": [\"dws:spark\"],\r\n        \"base\": \"dws:gold_ball\",\r\n        \"value\": 11,\r\n        \"type\": \"normal\",\r\n        \"duration\": 0,\r\n        \"speed\": 1,\r\n        \"consume\": 30,\r\n        \"range\": 2,\r\n        \"autoClear\": 150,\r\n        \"effect\": {\r\n            \"name\": [\"weakness\"],\r\n            \"time\": 5\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"冽海飓风\",\r\n        \"id\": 2,\r\n        \"attribute\": \"water\",\r\n        \"particle\": [\"dws:water_storm\"],\r\n        \"base\": \"dws:point\",\r\n        \"value\": 10,\r\n        \"type\": \"normal\",\r\n        \"duration\": 2,\r\n        \"speed\": 1,\r\n        \"consume\": 30,\r\n        \"range\": 3,\r\n        \"autoClear\": 150,\r\n        \"effect\": {\r\n            \"name\": [\"slowness\"],\r\n            \"time\": 5\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"遮天幻雾\",\r\n        \"id\": 3,\r\n        \"attribute\": \"earth\",\r\n        \"particle\": [\"dws:sand_particle\"],\r\n        \"base\": \"dws:sand\",\r\n        \"value\": 5,\r\n        \"type\": \"range\",\r\n        \"duration\": 0,\r\n        \"speed\": 0,\r\n        \"consume\": 30,\r\n        \"range\": 16,\r\n        \"autoClear\": 250,\r\n        \"effect\": {\r\n            \"name\": [\"weakness\", \"slowness\"],\r\n            \"time\": 15\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"千里追月\",\r\n        \"id\": 4,\r\n        \"attribute\": \"light\",\r\n        \"particle\": [\"dws:spark\"],\r\n        \"base\": \"dws:moon\",\r\n        \"value\": 11,\r\n        \"type\": \"normal\",\r\n        \"duration\": 0,\r\n        \"speed\": 2,\r\n        \"consume\": 30,\r\n        \"range\": 2,\r\n        \"autoClear\": 150,\r\n        \"effect\": {\r\n            \"name\": ['levitation'],\r\n            \"time\": 5\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"奇异光线\",\r\n        \"id\": 5,\r\n        \"attribute\": \"tree\",\r\n        \"particle\": [\"dws:tree_light\"],\r\n        \"base\": \"dws:greenpoint\",\r\n        \"value\": 11,\r\n        \"type\": \"line\",\r\n        \"duration\": 0,\r\n        \"speed\": 1,\r\n        \"consume\": 30,\r\n        \"range\": 2,\r\n        \"autoClear\": 150,\r\n        \"effect\": {\r\n            \"name\": [\"poison\"],\r\n            \"time\": 3\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"能量阵\",\r\n        \"id\": 6,\r\n        \"attribute\": \"all\",\r\n        \"particle\": [],\r\n        \"base\": null,\r\n        \"value\": 10,\r\n        \"type\": \"array\",\r\n        \"duration\": 0,\r\n        \"speed\": 1,\r\n        \"consume\": 1,\r\n        \"range\": 6,\r\n        \"autoClear\": -1,\r\n        \"effect\": {\r\n            \"name\": [],\r\n            \"time\": 5\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"能量晶石（勿点）\",\r\n        \"id\": 7,\r\n        \"attribute\": \"all\",\r\n        \"particle\": [],\r\n        \"base\": null,\r\n        \"value\": 10,\r\n        \"type\": \"array\",\r\n        \"duration\": 0,\r\n        \"speed\": 1,\r\n        \"consume\": 5,\r\n        \"range\": 6,\r\n        \"autoClear\": -1,\r\n        \"effect\": {\r\n            \"name\": [],\r\n            \"time\": 5\r\n        }\r\n    }\r\n]\r\n\r\ninterface NormalAbilityParticleSets {\r\n    initial: string[],\r\n    runtime: string[],\r\n    hitBlock: string[],\r\n    hitEntity: string[]\r\n}\r\n\r\ninterface NormalAbilityAttr {\r\n    projectileType: string,\r\n    damage: number,\r\n    /**\r\n     * Effects of this ability, key is effect name and value is [duration, amplifier].\r\n     */\r\n    effects?: Record<string, number[]>,\r\n    particles?: NormalAbilityParticleSets,\r\n    trace?: boolean\r\n}\r\n\r\nfunction normalAbilityCallback(attr: NormalAbilityAttr): AbilityCallbacks {\r\n    return {\r\n        start: (ability) => {\r\n            ability.spawnProjectile(attr.projectileType, ability.user.base.location, attr.trace ? TraceModeType.Trace : TraceModeType.Simple);\r\n            if (attr.particles?.initial) {\r\n                let loc = ability.user.base.location;\r\n                for (let particleName of attr.particles.initial)\r\n                    ability.user.base.dimension.spawnParticle(particleName, loc);\r\n            }\r\n        },\r\n        projectileCallbacks: {\r\n            hitEntity: (projectile, target) => {\r\n                target.applyDamage(attr.damage);\r\n                if (attr.effects) for (let effectName in attr.effects) {\r\n                    if (effectName == \"fire\") {\r\n                        target.setOnFire(attr.effects[effectName][0]);\r\n                        continue;\r\n                    }\r\n                    target.addEffect(effectName, attr.effects[effectName][0], { amplifier: attr.effects[effectName][1] });\r\n                }\r\n                if (attr.particles?.hitEntity) {\r\n                    let loc = projectile.base.location;\r\n                    for (let particleName of attr.particles.hitEntity)\r\n                        projectile.base.dimension.spawnParticle(particleName, loc);\r\n                }\r\n            },\r\n            hitBlock: (projectile, location) => {\r\n                if (attr.particles?.hitBlock) {\r\n                    let loc = location;\r\n                    for (let particleName of attr.particles.hitBlock)\r\n                        projectile.base.dimension.spawnParticle(particleName, loc);\r\n                }\r\n                projectile.base.dimension.createExplosion(location, attr.damage / 5);\r\n            },\r\n            main: (projectile) => {\r\n                if (attr.particles?.runtime) {\r\n                    let loc = projectile.base.location;\r\n                    for (let particleName of attr.particles.runtime)\r\n                        projectile.base.dimension.spawnParticle(particleName, loc);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const ABILITIES: Record<number, AbilityDefinition> = {\r\n    0: {\r\n        name: \"响雷火球\",\r\n        attributes: [ElementType.Fire],\r\n        types: [AbilityType.Offensive],\r\n        cost: 30,\r\n        duration: 150,\r\n        projectileAttr: {\r\n            speed: 1,\r\n            range: 2\r\n        },\r\n        callbacks: normalAbilityCallback({\r\n            projectileType: \"dws:fire_ball\",\r\n            damage: 11\r\n        })\r\n    },\r\n    1: {\r\n        name: \"奇异光线\",\r\n        attributes: [ElementType.Wood],\r\n        types: [AbilityType.Offensive],\r\n        cost: 30,\r\n        duration: 150,\r\n        callbacks: {\r\n            start: (ability) => {\r\n                let target = getClosestEnermy(ability.user.base);\r\n                let dir = {\r\n                    x: target.location.x - ability.user.base.location.x,\r\n                    y: target.location.y - ability.user.base.location.y,\r\n                    z: target.location.z - ability.user.base.location.z\r\n                }\r\n                let collision = new Ray(ability.user.base.location, dir, 10, ability.user.base.dimension);\r\n                ability.createDetection(collision);\r\n            },\r\n            detectingCallbacks: {\r\n                main: (box) => {\r\n                    for (let entity of box.entities) \r\n                        entity.applyDamage(5);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","\r\nexport class AbilityProgressError extends Error {\r\n    constructor(oldState: string, newState: string) {\r\n        let message = `Cannot transform the state of ability from state \"${oldState}\" to \"${newState}\".`\r\n        super(message);\r\n        this.name = \"AbilityProgressError\";\r\n    }\r\n}\r\n\r\nexport class AbilityIdentifierError extends Error {\r\n    constructor(abilityId: number) {\r\n        let message = `Cannot find ability id ${abilityId}.`\r\n        super(message);\r\n        this.name = \"AbilityIdentifierError\";\r\n    }\r\n}\r\n\r\nexport class AbilityInValidError extends Error {\r\n    constructor(abilityId: number, entityId: string) {\r\n        let message = `Entity ${entityId} doesn't has ability ${abilityId}.`\r\n        super(message);\r\n        this.name = \"AbilityInValidError\";\r\n    }\r\n}","\r\nexport class DragonIdentifierError extends Error {\r\n    constructor(identifier: string) {\r\n        let message = `Type \"${identifier}\" is not a dragon.`\r\n        super(message);\r\n        this.name = \"DragonIdentfierError\";\r\n    }\r\n}\r\nexport class DragonInValidError extends Error {\r\n    constructor(identifier: string) {\r\n        let message = `EntityId \"${identifier}\" is not valid in the world.`\r\n        super(message);\r\n        this.name = \"DragonInVaildError\";\r\n    }\r\n}","import { Entity } from \"@minecraft/server\";\r\nimport { Ability } from \"../modules/ability\";\r\nimport { Dragon, LivingDragon } from \"../modules/dragon\";\r\nimport { DragonInValidError } from \"../errors/dragonError\";\r\n\r\nexport class AbilityManager {\r\n    abilities: Record<number, Ability>;\r\n\r\n    constructor() {\r\n        this.abilities = {};\r\n    }\r\n\r\n    getById(abilityId: number) {\r\n        return this.abilities[abilityId];\r\n    }\r\n\r\n    getFromProjectile(projectile: Entity) {\r\n        let tags = projectile.getTags();\r\n        for (let tag of tags) {\r\n            if (tag.indexOf(\"projectile#\") >= 0) {\r\n                return this.getById(parseInt(tag.split(\"projectile#\")[1].split(\":\")[0]));\r\n            }\r\n        }\r\n    }\r\n\r\n    createAbility(user: Dragon, abilityId: number) {\r\n        if (user.base && user.base.isValid) {\r\n            let ability = new Ability(user as LivingDragon, abilityId);\r\n            this.abilities[ability.id] = ability;\r\n            return ability;\r\n        }\r\n        else throw new DragonInValidError(user.entityId);\r\n    }\r\n}\r\n\r\nexport const abilityManager = new AbilityManager();","import { world } from \"@minecraft/server\";\r\nimport { Warrior } from \"../modules/warrior\";\r\n\r\nexport class WarriorManager{\r\n    warriors: Record<string, Warrior>;\r\n\r\n    constructor() {\r\n        this.warriors = {};\r\n        world.afterEvents.playerSpawn.subscribe((arg) => {\r\n            if (!(arg.player.id in this.warriors)) {\r\n                this.warriors[arg.player.id] = new Warrior(arg.player.id);\r\n            }\r\n        })\r\n    }\r\n\r\n    getWarrior(playerId: string) {\r\n        if (!(playerId in this.warriors)) this.warriors[playerId] = new Warrior(playerId);\r\n        return this.warriors[playerId];\r\n    }\r\n}\r\n\r\nexport const warriorManager = new WarriorManager();","import { Player, world } from \"@minecraft/server\"\r\nimport { Dragon } from \"./dragon\";\r\nimport { dragonData } from \"../config/dragons\";\r\nimport { DragonIdentifierError } from \"../errors/dragonError\"\r\nimport { DragonExistError } from \"../errors/warriorError\"\r\nimport { WarriorData } from \"../interfaces/warrior\";\r\nimport { Watch } from \"./watch\";\r\n\r\nconst defaultData: WarriorData = {\r\n    dragons: {}\r\n}\r\n\r\n/**\r\n * Represents the state of a warrior (player).\r\n */\r\nexport class Warrior {\r\n    readonly base: Player;\r\n    readonly watch: Watch;\r\n\r\n    constructor(playerId: string) {\r\n        this.base = world.getEntity(playerId) as Player;\r\n        this.watch = new Watch(this.base);\r\n    }\r\n\r\n    /**\r\n     * Player's data.\r\n     */\r\n    get data(): WarriorData {\r\n        let data = this.base?.getDynamicProperty(\"dws\") as string;\r\n        if (!data) data = JSON.stringify(defaultData);\r\n        return JSON.parse(data) as WarriorData;\r\n    }\r\n    set data(warriorData: WarriorData) {\r\n        let data = JSON.stringify(warriorData);\r\n        this.base?.setDynamicProperty(\"dws\", data);\r\n    }\r\n\r\n    /**\r\n     * Dragons this player had.\r\n     */\r\n    get dragons(){\r\n        let dragonsData = this.data.dragons;\r\n        let dragonList: Dragon[] = [];\r\n        for (let dragonType in dragonsData) \r\n            dragonList.push(new Dragon(this.base.id, dragonType));\r\n        return dragonList;\r\n    }\r\n\r\n    /**\r\n     * Add a dragon which is currently exists in the world to the player.\r\n     */\r\n    addDragon(entityId: string, forceAdd=false){\r\n        let entity = world.getEntity(entityId);\r\n        if (!entity || !entity?.isValid) return;\r\n        if (entity.typeId in this.data.dragons && !forceAdd)\r\n            throw new DragonExistError(this.base.name, entity.typeId);\r\n        if (!(entity.typeId in dragonData)) \r\n            throw new DragonIdentifierError(entity.typeId);\r\n        let defaultAttr = {\r\n            entityId: entity.id, \r\n            exp: 0, \r\n            energy: 0, \r\n            ownerId: this.base.id\r\n        }\r\n        let data = Object.assign(defaultAttr, dragonData[entity.typeId]);\r\n        let warriorData = this.data;\r\n        warriorData.dragons[entity.typeId] = data;\r\n        this.data = warriorData;\r\n    }\r\n    /**\r\n     * Spawn and add a dragon to the player.\r\n     * @param typeId Type of target dragon.\r\n     * @param forceAdd Force to add or not.\r\n     */\r\n    addDragonByType(typeId: string, forceAdd=false) {\r\n        if (!(typeId in dragonData)) throw new DragonIdentifierError(typeId);\r\n        if (typeId in this.data.dragons && !forceAdd) throw new DragonExistError(this.base.name, typeId);\r\n        let entity = this.base.dimension.spawnEntity(typeId, this.base.location);\r\n        entity.getComponent(\"minecraft:tameable\")?.tame(this.base);\r\n        entity.triggerEvent(\"minecraft:on_tame\");\r\n        entity.addTag(`owner#${this.base.id}`);\r\n        this.addDragon(entity.id, forceAdd);\r\n    }\r\n    hasDragon(dragonType: string) {\r\n        return dragonType in this.data.dragons;\r\n    }\r\n    getDragon(dragonType: string) {\r\n        for (let dragon of this.dragons) {\r\n            if (dragon.typeId == dragonType) return this.dragons;\r\n        }\r\n    }\r\n    removeDragon(dragonType: string) {\r\n        if (this.hasDragon(dragonType)) {\r\n            let data = this.data;\r\n            delete data.dragons[dragonType];\r\n            this.data = data;\r\n        }\r\n    }\r\n}\r\n","import { Entity, EntityVariantComponent, Player, world } from \"@minecraft/server\"\r\nimport { dragonData } from \"../config/dragons\";\r\nimport { DragonData } from \"../interfaces/dragon\";\r\nimport { abilityManager } from \"../managers/abilityManager\";\r\n\r\nexport class Dragon {\r\n    /**\r\n     * rules to cauculate level and energy.\r\n     */\r\n    rules: ((exp: number) => number)[];\r\n    /**\r\n     * the owner's id.\r\n     */\r\n    ownerId: string;\r\n    /**\r\n     * Dragon's type.\r\n     */\r\n    typeId: string;\r\n\r\n    constructor(ownerId: string, typeId: string) {\r\n        // Only store these data.\r\n        this.ownerId = ownerId;\r\n        this.typeId = typeId;\r\n        this.rules = dragonData[this.typeId]['rules'];\r\n    }\r\n\r\n    get data(): DragonData {\r\n        let data = JSON.parse(this.owner.getDynamicProperty(\"dws\") as string) as any;\r\n        return data['dragons'][this.typeId];\r\n    }\r\n    private setData(key: any, value: any) {\r\n        let data = JSON.parse(this.owner.getDynamicProperty(\"dws\") as string) as any;\r\n        data['dragons'][this.typeId][key] = value;\r\n        this.owner.setDynamicProperty(\"dws\", JSON.stringify(data));\r\n    }\r\n\r\n    /**\r\n     * Chinese name or custom name tag of this dragon.\r\n     */\r\n    get name() {\r\n        return (this.isExist ? (this.base?.nameTag ? this.base?.nameTag : this.data.name) : this.data.name);\r\n    }\r\n    set name(value: string) {\r\n        if (this.isExist && this.base?.nameTag) {\r\n            this.base.nameTag = value;\r\n        }\r\n        this.setData(\"name\", value);\r\n    }\r\n    /**\r\n     * Current stage of this dragon, that is, evovled times.\r\n     */\r\n    get stage() {\r\n        return (this.base?.getComponent(\"minecraft:variant\") as EntityVariantComponent).value\r\n    }\r\n    get base() {\r\n        return world.getEntity(this.entityId);\r\n    }\r\n    get owner() {\r\n        return world.getEntity(this.ownerId) as Player;\r\n    }\r\n\r\n    get entityId(): string {\r\n        return this.data.entityId;\r\n    }\r\n    set entityId(value: string) {\r\n        this.setData(\"entityId\", value);\r\n    }\r\n\r\n    /**\r\n     * Abilities this dragon has, stores ability's ids.\r\n     */\r\n    get abilities() {\r\n        return this.data.abilities;\r\n    }\r\n    private set abilities(value: number[]) {\r\n        this.setData(\"abilities\", value);\r\n    }\r\n    addAbility(abilityId: number) {\r\n        if (!this.hasAbility(abilityId)) {\r\n            let abilities = this.abilities;\r\n            abilities.push(abilityId);\r\n            this.abilities = abilities\r\n        }\r\n    }\r\n    hasAbility(abilityId: number) {\r\n        return abilityId in this.abilities;\r\n    }\r\n    removeAbility(abilityId: number) {\r\n        if (this.hasAbility(abilityId)) {\r\n            let abilities = this.abilities;\r\n            abilities.splice(abilities.indexOf(abilityId), 1);\r\n            this.abilities = abilities\r\n        }\r\n    }\r\n    useAbility(abilityId: number) {\r\n        if (this.hasAbility(abilityId)) {\r\n            let ability = abilityManager.createAbility(this, abilityId);\r\n            return ability;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * current energy of this dragon.\r\n     */\r\n    get energy() {\r\n        return this.data.energy;\r\n    }\r\n    private set energy(value: number) {\r\n        this.setData(\"energy\", value);\r\n    }\r\n    addEnergy(value: number) {\r\n        let current = this.energy + value;\r\n        let remain = 0;\r\n        if (current > this.maxEnergy) {\r\n            remain = current - this.maxEnergy;\r\n            current = this.maxEnergy;\r\n        }\r\n        this.energy = current;\r\n        return remain;\r\n    }\r\n    reduceEnergy(value: number) {\r\n        let current = this.energy - value;\r\n        let remain = 0;\r\n        if (current < 0) {\r\n            remain = -current;\r\n            current = 0;\r\n        }\r\n        this.energy = current;\r\n        return remain;\r\n    }\r\n    /**\r\n     * max energy of this dragon.\r\n     */\r\n    get maxEnergy() {\r\n        let energyRule = this.rules[1];\r\n        return energyRule(this.exp);\r\n    }\r\n\r\n    /**\r\n     * Dragon's attributes, a list.\r\n     */\r\n    get attributes() {\r\n        return this.data.attributes;\r\n    }\r\n    set attributes(value: string[]) {\r\n        this.setData(\"attributes\", value);\r\n    }\r\n    /**\r\n     * Add a attribute.\r\n     * @param attrType Attribute to add.\r\n     */\r\n    addAttribute(attrType: string) {\r\n        if (!this.hasAttribute(attrType)) {\r\n            let attrs = this.attributes;\r\n            attrs.push(attrType);\r\n            this.attributes = attrs;\r\n        }\r\n    }\r\n    hasAttribute(attrType: string) {\r\n        return attrType in this.attributes;\r\n    }\r\n    removeAttribute(attrType: string) {\r\n        if (this.hasAttribute(attrType)) {\r\n            let attrs = this.attributes;\r\n            attrs.splice(attrs.indexOf(attrType), 1);\r\n            this.attributes = attrs;\r\n        }\r\n    }\r\n\r\n    get exp() {\r\n        return this.data.exp;\r\n    }\r\n    private set exp(value: number) {\r\n        this.setData(\"exp\", value);\r\n    }\r\n    get maxExp() {\r\n        return this.data.maxExp;\r\n    }\r\n    /**\r\n     * Add exp to this dragon.\r\n     * @param value exp to add.\r\n     * @returns Remains amount.\r\n     */\r\n    addExp(value: number) {\r\n        let current = this.exp + value;\r\n        let remain = 0;\r\n        if (current > this.maxExp) {\r\n            remain = current - this.maxExp;\r\n            current = this.maxExp;\r\n        }\r\n        this.exp = current;\r\n        return remain;\r\n    }\r\n    /**\r\n     * Reduce exp from this dragon.\r\n     * @param value exp to reduce.\r\n     * @returns Remains amount.\r\n     */\r\n    reduceExp(value: number) {\r\n        let current = this.exp - value;\r\n        let remain = 0;\r\n        if (current < 0) {\r\n            remain = -current;\r\n            current = 0;\r\n        }\r\n        this.exp = current;\r\n        return remain;\r\n    }\r\n\r\n    /**\r\n     * current level of this dragon.\r\n     */\r\n    get level() {\r\n        let levelRule = this.rules[0];\r\n        return levelRule(this.exp);\r\n    }\r\n    /**\r\n     * max level of this dragon.\r\n     */\r\n    get maxLevel() {\r\n        return this.rules[0](this.data.maxExp);\r\n    }\r\n\r\n    /**\r\n     * Returns true if this dragon exist in the world.\r\n     */\r\n    get isExist() {\r\n        let entity = world.getEntity(this.entityId);\r\n        return entity && entity.isValid ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Switch the in / out state of this dragon.\r\n     * @returns True if this dragon is out now else false.\r\n     */\r\n    switchState(): boolean {\r\n        if (this.isExist) {\r\n            // call in\r\n            this.base?.teleport({ x: this.base.location.x, y: this.base.location.y + 10, z: this.base.location.z });\r\n            let loc = this.base?.location;\r\n            this.base?.runCommand(`structure save \"${this.owner.name}_${this.typeId}\" ${loc?.x} ${loc?.y} ${loc?.z} ${loc?.x} ${loc?.y} ${loc?.z} true disk`);\r\n            this.base?.remove();\r\n            return false;\r\n        }\r\n        // call out\r\n        let loc = this.owner.location;\r\n        this.owner.runCommand(`structure load \"${this.owner.name}_${this.typeId}\" ${loc.x} ${loc.y + 1} ${loc.z}`);\r\n        let dragons = this.owner.dimension.getEntities({type: this.typeId});\r\n        dragons.forEach((dragon) => {\r\n            for (let tag of dragon.getTags()) {\r\n                if (tag.indexOf(\"owner#\") >= 0) {\r\n                    if (tag.replace(\"owner#\", \"\") == this.ownerId) this.entityId = dragon.id;\r\n                    break;\r\n                }\r\n            }\r\n        })\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Evolve this dragon.\r\n     */\r\n    evolve(forceEvolve = false) {\r\n        //\r\n    }\r\n\r\n    getInfo() {\r\n        return `等级：${this.level} / ${this.maxLevel} \\n`;\r\n    }\r\n}\r\n\r\nexport class LivingDragon extends Dragon {\r\n    get base() { return world.getEntity(this.entityId) as Entity; }\r\n}","\r\nexport class DragonExistError extends Error {\r\n    constructor(playerName: string, entityType: string) {\r\n        let message = `Player \"${playerName}\" already has a dragon \"${entityType}\".`\r\n        super(message);\r\n        this.name = \"DragonExistError\";\r\n    }\r\n}","import { Player, RawText } from \"@minecraft/server\";\r\nimport { ActionFormData } from \"@minecraft/server-ui\";\r\nimport { Warrior } from \"./warrior\";\r\nimport { manager } from \"../managers/manager\";\r\n\r\n\r\nclass DWSUI {\r\n    titleText: string | RawText;\r\n    bodyText: string | RawText;\r\n    buttons: Record<string, any>;\r\n\r\n    constructor() {\r\n        this.titleText = \"\";\r\n        this.bodyText = \"\";\r\n        this.buttons = {};\r\n    }\r\n\r\n    title(titleText: string | RawText) {\r\n        this.titleText = titleText;\r\n        return this;\r\n    }\r\n\r\n    body(bodyText: string | RawText) {\r\n        this.bodyText = bodyText;\r\n        return this;\r\n    }\r\n\r\n    button(text: string, iconPath = \"\") {\r\n        this.buttons[text] = iconPath;\r\n        return this;\r\n    }\r\n\r\n    show(player: Player) {\r\n        //set color\r\n        let color = '§' + (player.getDynamicProperty('color') || \"w\");\r\n        let titleText = this.titleText;\r\n        if (typeof this.titleText == undefined) titleText = '';\r\n        if (typeof titleText == 'string') titleText += color;\r\n        else {\r\n            if (titleText.rawtext) titleText.rawtext.push({ 'text': color });\r\n            else titleText.rawtext = [{ \"text\": color }];\r\n        }\r\n        //show ui\r\n        let ui = new ActionFormData()\r\n            .title(titleText)\r\n            .body(this.bodyText);\r\n        for (let buttonId in this.buttons) ui.button(buttonId, this.buttons[buttonId]);\r\n        return ui.show(player as any);\r\n    }\r\n}\r\n\r\nexport class Watch {\r\n    form: DWSUI;\r\n    player: Player;\r\n\r\n    constructor(player: Player) {\r\n        this.player = player;\r\n        this.form = new DWSUI();\r\n        this.form.title(\"斗龙手环\");\r\n        this.form.button(\"召唤/召回\");\r\n    }\r\n\r\n    /**\r\n     * Chioce form.\r\n     */\r\n    private get choiceForm() {\r\n        let form = new DWSUI();\r\n        form.title(\"选择\");\r\n        let dragons = manager.warrior.getWarrior(this.player.id).dragons;\r\n        for (let dragon of dragons) form.button(dragon.name);\r\n        return form;\r\n    }\r\n\r\n    /**\r\n     * Switch states of dragons.\r\n     */\r\n    switchState(selectId: number) {\r\n        let warrior = manager.warrior.getWarrior(this.player.id);\r\n        let dragons = warrior.dragons;\r\n        let selected = dragons[selectId];\r\n        selected.switchState();\r\n    }\r\n\r\n    /**\r\n     * show infos of dragons. \r\n     */\r\n    showInfo() {\r\n        let warrior = manager.warrior.getWarrior(this.player.id);\r\n        //\r\n    }\r\n\r\n    show() {\r\n        this.form.show(this.player).then((arg) => {\r\n            if (arg.canceled) return;\r\n            switch (arg.selection) {\r\n                case 0:\r\n                    this.choiceForm.show(this.player).then((arg) => {\r\n                        if (arg.canceled) return;\r\n                        this.switchState(arg.selection as number);\r\n                    });\r\n                    break;\r\n                case 1:\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n}","import { abilityManager, AbilityManager } from \"./abilityManager\";\r\nimport { warriorManager, WarriorManager } from \"./warriorManager\";\r\n\r\nclass Manager{\r\n    readonly warrior: WarriorManager;\r\n    readonly ability: AbilityManager;\r\n\r\n    constructor() {\r\n        this.warrior = warriorManager;\r\n        this.ability = abilityManager;\r\n    }\r\n}\r\n\r\n/**\r\n * Manages warriors and abilities.\r\n */\r\nexport const manager = new Manager();"],"mappings":"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","names":["world","dist","world","world","loc","arg","world","world","world"],"file":"../scripts/main.js"}