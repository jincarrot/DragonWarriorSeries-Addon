{"version":3,"sources":["../../scripts/main.ts","../../scripts/watch3.0/modules/dragon.ts","../../scripts/watch3.0/config/dragons.ts"],"sourcesContent":["import { world } from \"@minecraft/server\"\r\nimport { Dragon } from \"./watch3.0/modules/dragon\"\r\n\r\nlet aEvents = world.afterEvents;\r\n\r\naEvents.entityHitEntity.subscribe((arg) => {\r\n    world.sendMessage(arg.damagingEntity.typeId);\r\n    let temp = new Dragon(arg.damagingEntity.id, \"dws:reguman\");\r\n})","import { Entity, EntityVariantComponent, Player, world } from \"@minecraft/server\"\r\nimport { dragonData } from \"../config/dragons\";\r\n\r\ninterface DragonData {\r\n    entityId: string;\r\n    attributes: string[];\r\n    abilities: number[];\r\n    maxLevel: number;\r\n    energy: number;\r\n    /**\r\n     * exp refresh rules\r\n     * \r\n     * A list, index 0 is level and 1 is max energy\r\n     */\r\n    rules: ((exp: number) => number)[];\r\n    ownerId: string;\r\n    exp: number;\r\n}\r\n\r\nexport class Dragon{\r\n    /**\r\n     * rules to cauculate level and energy.\r\n     */\r\n    rules: ((exp: number) => number)[];\r\n\r\n    /**\r\n     * the owner's id.\r\n     */\r\n    ownerId: string;\r\n\r\n    /**\r\n     * Dragon's type.\r\n     */\r\n    typeId: string;\r\n\r\n    constructor(ownerId: string, typeId: string) {\r\n        // Only store these data.\r\n        this.ownerId = ownerId;\r\n        this.typeId = typeId;\r\n        this.rules = dragonData[this.typeId]['rules'];\r\n    }\r\n\r\n    /**\r\n     * Current stage of this dragon, that is, evovled times.\r\n     */\r\n    get state() {\r\n        return (this.base?.getComponent(\"minecraft:variant\") as EntityVariantComponent).value\r\n    }\r\n\r\n    get data(): DragonData {\r\n        let data = JSON.parse(this.owner.getDynamicProperty(\"dws\") as string) as any;\r\n        return data['dragons'][this.typeId];\r\n    }\r\n\r\n    get entityId(): string {\r\n        return this.data.entityId;\r\n    }\r\n\r\n    /**\r\n     * Abilities this dragon has, stores ability's ids.\r\n     */\r\n    get abilities() {\r\n        return this.data.abilities;\r\n    }\r\n\r\n    /**\r\n     * max level of this dragon.\r\n     */\r\n    get maxLevel() {\r\n        return this.data.maxLevel;\r\n    }\r\n\r\n    /**\r\n     * current energy of this dragon.\r\n     */\r\n    get energy() {\r\n        return this.data.energy;\r\n    }\r\n\r\n    /**\r\n     * Dragon's attributes, a list.\r\n     */\r\n    get attributes() {\r\n        return this.data.attributes;\r\n    }\r\n\r\n    get base() {\r\n        return world.getEntity(this.entityId);\r\n    }\r\n\r\n    get exp() {\r\n        return this.data.exp;\r\n    }\r\n\r\n    set exp(value: number) {\r\n        this.setData(\"exp\", value);\r\n    }\r\n    \r\n    get owner() {\r\n        return world.getEntity(this.ownerId) as Player;\r\n    }\r\n\r\n    /**\r\n     * current level of this dragon.\r\n     */\r\n    get level(){\r\n        let levelRule = this.rules[0];\r\n        return levelRule(this.exp);\r\n    }\r\n\r\n    /**\r\n     * max energy of this dragon.\r\n     */\r\n    get maxEnergy() {\r\n        let energyRule = this.rules[1];\r\n        return energyRule(this.exp);\r\n    }\r\n\r\n    /**\r\n     * Returns true if this dragon exist in the world.\r\n     */\r\n    get isExist(){\r\n        let entity = world.getEntity(this.entityId);\r\n        return entity && entity.isValid ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Switch the in / out state of this dragon.\r\n     * @returns True if this dragon is out now else false.\r\n     */\r\n    switchState(): boolean{\r\n        if (this.isExist) {\r\n            // call in\r\n            return false;\r\n        }\r\n        // call out\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Evolve this dragon.\r\n     */\r\n    evolve(forceEvolve=false) {\r\n        //\r\n    }\r\n\r\n    private setData(key: any, value: any) {\r\n        let data = JSON.parse(this.owner.getDynamicProperty(\"dws\") as string) as any;\r\n        data['dragons'][this.typeId][key] = value;\r\n        this.owner.setDynamicProperty(\"dws\", JSON.stringify(data));\r\n    }\r\n}","function defaultLevelRule(exp: number): number {\r\n    return Math.floor(Math.sqrt(exp));\r\n}\r\n\r\nfunction defaultEnergyRule(exp: number): number {\r\n    return Math.floor(Math.sqrt(exp)) * 20;\r\n}\r\n\r\nexport let dragonData: Record<string, any> = {\r\n    \"dws:reguman\": {\r\n        maxLevel: 10,\r\n        name: \"雷古曼\",\r\n        rules: [defaultLevelRule, defaultEnergyRule],\r\n        attributes: [\"fire\"],\r\n        abilities: [],\r\n    }\r\n}\r\n"],"mappings":"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","names":["world","world"],"file":"../scripts/main.js"}